## 10. SUBSCRIPTION MANAGEMENT (STRIPE)

### 10.1 Pricing Page

**Output:**

- 2 plan összehasonlítása:
    - Ingyenes (0 Ft)
    - Prémium (2990 Ft/hó vagy 29990 Ft/év)
- Feature comparison táblázat
- "Előfizetek" gombok

### 10.2 Stripe Checkout

**Flow:**

1. User clicks "Előfizetek Prémium Havi"
2. POST /api/stripe/create-checkout
3. Redirect to Stripe Checkout
4. User pays
5. Redirect back: /success?session_id=xxx

**CRUD:**

```sql
UPDATE User
SET subscription_plan = 'PREMIUM',
    subscription_start = NOW(),
    subscription_end = NOW() + INTERVAL 1 MONTH,
    stripe_customer_id = ?
WHERE id = ?
```

### 10.3 Webhook (Stripe → Backend)

**Events:**

- `checkout.session.completed` → Activate subscription
- `invoice.payment_succeeded` → Renew subscription
- `customer.subscription.deleted` → Cancel subscription

**CRUD:**

```sql
UPDATE User
SET subscription_plan = 'FREE'
WHERE stripe_customer_id = ?
```

### 10.4 Subscription Status Screen

**Output:**

- Current plan
- Renewal date
- "Lemondás" gomb (ha Premium)
- "Upgrade" gomb (ha Free)

### 10.5 Cancel Subscription

**Flow:**

- Confirmation: "Biztosan lemondod?"
- API call to Stripe: cancel at period end
- User marad Premium a billing cycle végéig

---